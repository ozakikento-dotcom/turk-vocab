<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Turkish Vocab Trainer</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  background: #eefbf0;
  font-family: "Nunito", sans-serif;
  margin: 0;
  padding: 0;
  text-align: center;
  color: #222;
}

/* ---------- HEADER ---------- */
header {
  background: #58cc02;
  color: white;
  padding: 16px;
  font-size: 28px;
  font-weight: 700;
  box-shadow: 0 2px 4px #0002;
}

/* ---------- TAB BUTTONS ---------- */
.tabbar {
  display: flex;
  justify-content: space-around;
  background: #ffffff;
  padding: 10px 0;
  border-bottom: 2px solid #d5f5d8;
}

.tabbar button {
  font-size: 18px;
  padding: 8px 14px;
  border: none;
  border-radius: 12px;
  background: #dfffdc;
  color: #2f7d1e;
  font-weight: 600;
  cursor: pointer;
}

.tabbar button.active {
  background: #58cc02;
  color: white;
}

/* ---------- MAIN BOX ---------- */
.box {
  background: white;
  border-radius: 18px;
  padding: 28px;
  margin: 24px auto;
  width: 90%;
  max-width: 520px;
  box-shadow: 0 4px 10px #0001;
}

#question {
  font-size: 32px;
  font-weight: bold;
  margin-bottom: 20px;
}

/* ---------- CHOICE BUTTONS ---------- */
.choice {
  background: #fff;
  color: #444;
  border: 2px solid #cccccc;
  border-radius: 12px;
  padding: 16px;
  font-size: 20px;
  margin: 10px auto;
  width: 80%;
  max-width: 400px;
  cursor: pointer;
  transition: 0.2s;
}

.choice:hover {
  background: #e8ffe8;
}

/* ---------- INPUT MODE ---------- */
.inputField {
  width: 80%;
  padding: 18px;
  font-size: 24px;
  border-radius: 12px;
  border: 2px solid #aaa;
  margin-bottom: 12px;
  text-align: center;
}

.tr-keys button {
  background: #fff;
  color: #58cc02;
  border: none;
  font-size: 24px;
  padding: 10px 14px;
  margin: 4px;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 2px 4px #0001;
}
.tr-keys button:hover {
  background: #eaffea;
}

/* ---------- ACTION BUTTONS ---------- */
.mainBtn {
  background: #58cc02;
  color: white;
  border: none;
  border-radius: 14px;
  padding: 14px 26px;
  font-size: 22px;
  font-weight: 700;
  cursor: pointer;
  margin: 10px;
}
.mainBtn:hover { background:#46a601 }

/* ---------- STATS ---------- */
.statbox {
  background: white;
  padding: 20px;
  width: 80%;
  margin: 20px auto;
  border-radius: 16px;
  box-shadow: 0 3px 8px #0002;
  text-align: left;
  font-size: 18px;
}

/* Animation for correct/incorrect */
.correctFlash {
  animation: correctAnim 0.4s;
}
@keyframes correctAnim {
  from { background:#b7ffb7; }
  to { background:white; }
}
.wrongFlash {
  animation: wrongAnim 0.4s;
}
@keyframes wrongAnim {
  from { background:#ffd2d2; }
  to { background:white; }
}

.feedback {
  margin-top: 16px;
  padding: 14px;
  border-radius: 12px;
  background: #f4fff0;
  border: 1px solid #c7e6bc;
  text-align: left;
  display: none;
}
.feedback .fb-title {
  font-weight: 700;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.feedback .fb-title.ok { color:#2e8b26; }
.feedback .fb-title.ng { color:#c0392b; }
.feedback .fb-answer { font-size: 20px; margin-bottom: 6px; }
.feedback .fb-example { color:#333; margin-bottom:6px; }
.feedback .fb-hint { color:#4f6b45; font-size: 16px; }
.feedback .fb-repeat {
  background: #2f7d1e;
  margin-top: 8px;
}

.hintText {
  color:#4b6d3a;
  margin: 8px 0 0;
  font-size: 16px;
}
</style>
</head>

<body>

<header>Turkish Vocab Trainer</header>

<!-- TABS -->
<div class="tabbar">
  <button id="tabChoice" class="active">4æŠ</button>
  <button id="tabInput">å…¥åŠ›</button>
  <button id="tabStats">Stats</button>
  <button id="tabMistake">è‹¦æ‰‹èªå½™</button>
  <button id="tabFilter">å“è©åˆ¥</button>
</div>

<!-- QUIZ AREA -->
<div id="contentArea">

  <!-- 4æŠãƒ¢ãƒ¼ãƒ‰ -->
  <div id="choiceMode" class="box">
    <div id="question"></div>
    <div id="choices"></div>
    <div id="choiceFeedback" class="feedback">
      <div class="fb-title"></div>
      <div class="fb-answer"></div>
      <div class="fb-example"></div>
      <div class="fb-hint"></div>
      <button class="mainBtn fb-repeat">ã‚‚ã†ä¸€åº¦è§£ã</button>
    </div>
    <button class="mainBtn" id="nextBtn">æ¬¡ã¸</button>
  </div>

  <!-- å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ -->
  <div id="inputMode" class="box" style="display:none;">
    <div id="question_input"></div>
    <input type="text" id="inputAnswer" class="inputField" placeholder="ãƒˆãƒ«ã‚³èªã§å…¥åŠ›" />
    <div class="tr-keys">
      <button>Ã§</button><button>ÄŸ</button><button>Ä±</button><button>Ä°</button>
      <button>Ã¶</button><button>ÅŸ</button><button>Ã¼</button>
      <button>Ã‡</button><button>Ä</button><button>Ã–</button>
      <button>Å</button><button>Ãœ</button>
      <button>.</button><button>?</button>
    </div>
    <div id="inputFeedback" class="feedback">
      <div class="fb-title"></div>
      <div class="fb-answer"></div>
      <div class="fb-example"></div>
      <div class="fb-hint"></div>
      <button class="mainBtn fb-repeat">ã‚‚ã†ä¸€åº¦è§£ã</button>
    </div>
    <button class="mainBtn" id="inputCheck">ç­”ãˆã‚‹</button>
    <button class="mainBtn" id="inputNext">æ¬¡ã¸</button>
  </div>

  <!-- Stats -->
  <div id="statsMode" style="display:none;">
    <div class="statbox">
      <h2>ğŸ“Š Stats</h2>
      <p id="stat_total"></p>
      <p id="stat_correct"></p>
      <p id="stat_wrong"></p>
      <p id="stat_rate"></p>
      <h3>è‹¦æ‰‹èªå½™ TOP10</h3>
      <ul id="stat_mistake"></ul>
    </div>
  </div>

  <!-- è‹¦æ‰‹èªå½™ãƒ¢ãƒ¼ãƒ‰ -->
  <div id="mistakeMode" class="box" style="display:none;">
    <h3>è‹¦æ‰‹èªå½™ãƒ¢ãƒ¼ãƒ‰</h3>
    <div id="mistakeInfo"></div>
    <div id="mistakeQuestion"></div>
    <div id="mistakeChoices"></div>
    <div id="mistakeFeedback" class="feedback">
      <div class="fb-title"></div>
      <div class="fb-answer"></div>
      <div class="fb-example"></div>
      <div class="fb-hint"></div>
      <button class="mainBtn fb-repeat">ã‚‚ã†ä¸€åº¦è§£ã</button>
    </div>
    <button class="mainBtn" id="mistakeNext">æ¬¡ã¸</button>
  </div>

  <!-- å“è©åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ -->
  <div id="filterMode" class="box" style="display:none;">
    <h3>å“è©ã§é¸ã¶</h3>
    <select id="posSelect" style="font-size:20px;padding:10px;border-radius:10px;">
      <option value="all">å…¨éƒ¨</option>
      <option value="noun">åè©</option>
      <option value="verb">å‹•è©</option>
      <option value="adj">å½¢å®¹è©</option>
      <option value="adv">å‰¯è©</option>
      <option value="other">ãã®ä»–</option>
    </select>
    <button class="mainBtn" id="filterStart">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>

</div>

<script src="vocab.js"></script>

<script>
// ---------------------
// DATA
// ---------------------
let current = null;
let mode = "choice"; 
let filteredList = [...vocab];
let mistakeList = JSON.parse(localStorage.getItem("mistakeList") || "[]");
let reviewStack = [];

// Stats
let total = Number(localStorage.getItem("total") || 0);
let correct = Number(localStorage.getItem("correct") || 0);
let wrong = Number(localStorage.getItem("wrong") || 0);

// ---------------------
// TAB SWITCHING
// ---------------------
function showTab(name){
  mode = name;

  document.getElementById("choiceMode").style.display = (name==="choice")?"block":"none";
  document.getElementById("inputMode").style.display = (name==="input")?"block":"none";
  document.getElementById("statsMode").style.display = (name==="stats")?"block":"none";
  document.getElementById("mistakeMode").style.display = (name==="mistake")?"block":"none";
  document.getElementById("filterMode").style.display = (name==="filter")?"block":"none";

  document.querySelectorAll(".tabbar button").forEach(btn=>btn.classList.remove("active"));
  if(name==="choice") tabChoice.classList.add("active");
  if(name==="input") tabInput.classList.add("active");
  if(name==="stats") tabStats.classList.add("active");
  if(name==="mistake") tabMistake.classList.add("active");
  if(name==="filter") tabFilter.classList.add("active");

  if(name==="stats") drawStats();
  if(name==="mistake") newMistakeQuestion();
}

tabChoice.onclick = ()=>{ showTab("choice"); newQuestion(); };
tabInput.onclick = ()=>{ showTab("input"); newInputQuestion(); };
tabStats.onclick = ()=>{ showTab("stats"); };
tabMistake.onclick = ()=>{ showTab("mistake"); };
tabFilter.onclick = ()=>{ showTab("filter"); };

// ---------------------
// RANDOM QUESTION
// ---------------------
function pickRandom(list){
  return list[Math.floor(Math.random()*list.length)];
}

function getNextWord(){
  if(reviewStack.length>0) return reviewStack.shift();
  return pickRandom(filteredList);
}

function queueReview(wordObj){
  if(!reviewStack.includes(wordObj)){
    reviewStack.unshift(wordObj);
  }
}

function buildHint(wordObj){
  const posMap = {
    noun:"åè©",
    verb:"å‹•è©",
    adj:"å½¢å®¹è©",
    adv:"å‰¯è©",
    num:"æ•°å­—",
    pron:"ä»£åè©",
    expression:"ãƒ•ãƒ¬ãƒ¼ã‚º",
    other:"ãã®ä»–"
  };
  const pos = posMap[wordObj.pos] || "èª";
  return `å“è©:${pos} / æœ€åˆã®æ–‡å­—:${wordObj.a.slice(0,1)}`;
}

function showFeedback(area, isCorrect, wordObj){
  const box = document.getElementById(area+"Feedback");
  const title = box.querySelector(".fb-title");
  const answer = box.querySelector(".fb-answer");
  const example = box.querySelector(".fb-example");
  const hint = box.querySelector(".fb-hint");
  const repeatBtn = box.querySelector(".fb-repeat");

  box.style.display = "block";
  title.textContent = isCorrect ? "æ­£è§£ï¼ã‚ˆãã§ãã¾ã—ãŸ" : "è¦šãˆã‚ˆã†";
  title.className = "fb-title " + (isCorrect ? "ok" : "ng");
  answer.textContent = `ç­”ãˆ: ${wordObj.a}`;
  example.textContent = `ä¾‹æ–‡: ${wordObj.ex}`;
  hint.textContent = isCorrect ? "æ¬¡ã‚‚åŒã˜èª¿å­ã§ï¼" : `ãƒ’ãƒ³ãƒˆ: ${buildHint(wordObj)}`;

  if(isCorrect){
    repeatBtn.style.display = "none";
  } else {
    repeatBtn.style.display = "inline-block";
    repeatBtn.onclick = ()=>{
      queueReview(wordObj);
      hint.textContent = "æ¬¡ã«åŒã˜å˜èªã‚’å‡ºã—ã¾ã™ã€‚";
    };
  }
}

function hideFeedback(area){
  const box = document.getElementById(area+"Feedback");
  if(box) box.style.display = "none";
}

// ========== 4æŠ ==========
function newQuestion(){
  current = getNextWord();
  question.innerText = current.q;

  let arr = [current.a, ...current.c].sort(()=>Math.random()-0.5);
  choices.innerHTML = "";
  hideFeedback("choice");

  arr.forEach(ans=>{
    let btn = document.createElement("button");
    btn.className = "choice";
    btn.innerText = ans;
    btn.onclick = ()=>checkChoice(ans);
    choices.appendChild(btn);
  });
}

function checkChoice(ans){
  total++;

  if(ans === current.a){
    correct++;
    flash("choiceMode","correctFlash");
  } else {
    wrong++;
    flash("choiceMode","wrongFlash");
    addMistake(current.a);
    queueReview(current);
  }

  showFeedback("choice", ans === current.a, current);
  saveStats();
}
nextBtn.onclick = newQuestion;

// ========== å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ ==========
function newInputQuestion(){
  current = getNextWord();
  document.getElementById("question_input").innerText = current.q;
  inputAnswer.value = "";
  inputAnswer.focus();
  hideFeedback("input");
}

inputCheck.onclick = ()=>{
  total++;
  let user = inputAnswer.value.trim().toLowerCase();
  let real = current.a.toLowerCase();
  if(user === real){
    correct++;
    flash("inputMode","correctFlash");
  } else {
    wrong++;
    flash("inputMode","wrongFlash");
    addMistake(current.a);
    queueReview(current);
  }
  showFeedback("input", user === real, current);
  saveStats();
};
inputNext.onclick = newInputQuestion;

// æ–‡å­—ãƒœã‚¿ãƒ³
document.querySelectorAll(".tr-keys button").forEach(btn=>{
  btn.onclick = ()=>{
    inputAnswer.value += btn.textContent;
    inputAnswer.focus();
  }
});

// ---------------------
// è‹¦æ‰‹èªå½™
// ---------------------
function addMistake(word){
  if(!mistakeList.includes(word)){
    mistakeList.push(word);
    localStorage.setItem("mistakeList", JSON.stringify(mistakeList));
  }
}

function newMistakeQuestion(){
  if(mistakeList.length === 0){
    mistakeInfo.innerHTML = "<p>è‹¦æ‰‹èªå½™ã¯ã‚ã‚Šã¾ã›ã‚“ï¼</p>";
    mistakeQuestion.innerHTML = "";
    mistakeChoices.innerHTML = "";
    hideFeedback("mistake");
    return;
  }

  let word = pickRandom(mistakeList);
  current = vocab.find(v=>v.a === word);

  mistakeInfo.innerHTML = `<p>è‹¦æ‰‹èªå½™ï¼š${mistakeList.length}èª</p>`;
  mistakeQuestion.innerText = current.q;
  hideFeedback("mistake");

  let arr = [current.a, ...current.c].sort(()=>Math.random()-0.5);
  mistakeChoices.innerHTML = "";
  arr.forEach(ans=>{
    let btn = document.createElement("button");
    btn.className = "choice";
    btn.innerText = ans;
    btn.onclick = ()=>checkMistake(ans, word);
    mistakeChoices.appendChild(btn);
  });
}

function checkMistake(ans, word){
  total++;
  if(ans === word){
    correct++;
    mistakeList = mistakeList.filter(x=>x !== word);
    localStorage.setItem("mistakeList", JSON.stringify(mistakeList));
    flash("mistakeMode","correctFlash");
  } else {
    wrong++;
    flash("mistakeMode","wrongFlash");
    queueReview(current);
  }
  showFeedback("mistake", ans === word, current);
  saveStats();
}

mistakeNext.onclick = newMistakeQuestion;

// ---------------------
// å“è©åˆ¥
// ---------------------
filterStart.onclick = ()=>{
  let p = posSelect.value;
  if(p==="all") filteredList = [...vocab];
  else filteredList = vocab.filter(v=>v.pos===p);

  alert("ãƒ•ã‚£ãƒ«ã‚¿å®Œäº†ï¼å•é¡Œã‚’é–‹å§‹ã—ã¾ã™ã€‚");
  showTab("choice");
  newQuestion();
};

// ---------------------
// Stats
// ---------------------
function saveStats(){
  localStorage.setItem("total", total);
  localStorage.setItem("correct", correct);
  localStorage.setItem("wrong", wrong);
}

function drawStats(){
  stat_total.innerText = "ç·å›ç­”æ•°ï¼š" + total;
  stat_correct.innerText = "æ­£è§£ï¼š" + correct;
  stat_wrong.innerText = "ä¸æ­£è§£ï¼š" + wrong;
  let rate = (correct/(total||1)*100).toFixed(1);
  stat_rate.innerText = "æ­£ç­”ç‡ï¼š" + rate + "%";

  stat_mistake.innerHTML = "";
  mistakeList.slice(0,10).forEach(w=>{
    let li = document.createElement("li");
    li.innerText = w;
    stat_mistake.appendChild(li);
  });
}

// ---------------------
// Utility
// ---------------------
function flash(id, cls){
  let box = document.getElementById(id);
  box.classList.add(cls);
  setTimeout(()=>box.classList.remove(cls),400);
}

// Start
newQuestion();
</script>

</body>
</html>
