<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Turkish Vocab Trainer</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body {
  background: #eefbf0;
  font-family: "Nunito", sans-serif;
  margin: 0;
  padding: 0;
  text-align: center;
  color: #222;
}

/* ---------- HEADER ---------- */
header {
  background: #58cc02;
  color: white;
  padding: 16px;
  font-size: 28px;
  font-weight: 700;
  box-shadow: 0 2px 4px #0002;
}

/* ---------- TAB BUTTONS ---------- */
.tabbar {
  display: flex;
  justify-content: space-around;
  background: #ffffff;
  padding: 10px 0;
  border-bottom: 2px solid #d5f5d8;
}

.tabbar button {
  font-size: 18px;
  padding: 8px 14px;
  border: none;
  border-radius: 12px;
  background: #dfffdc;
  color: #2f7d1e;
  font-weight: 600;
  cursor: pointer;
}

.tabbar button.active {
  background: #58cc02;
  color: white;
}

/* ---------- MAIN BOX ---------- */
.box {
  background: white;
  border-radius: 18px;
  padding: 28px;
  margin: 24px auto;
  width: 90%;
  max-width: 520px;
  box-shadow: 0 4px 10px #0001;
}

#question {
  font-size: 32px;
  font-weight: bold;
  margin-bottom: 20px;
}

/* ---------- CHOICE BUTTONS ---------- */
.choice {
  background: #fff;
  color: #444;
  border: 2px solid #cccccc;
  border-radius: 12px;
  padding: 16px;
  font-size: 20px;
  margin: 10px auto;
  width: 80%;
  max-width: 400px;
  cursor: pointer;
  transition: 0.2s;
}

.choice:hover {
  background: #e8ffe8;
}

/* ---------- INPUT MODE ---------- */
.inputField {
  width: 80%;
  padding: 18px;
  font-size: 24px;
  border-radius: 12px;
  border: 2px solid #aaa;
  margin-bottom: 12px;
  text-align: center;
}

.tr-keys button {
  background: #fff;
  color: #58cc02;
  border: none;
  font-size: 24px;
  padding: 10px 14px;
  margin: 4px;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 2px 4px #0001;
}
.tr-keys button:hover {
  background: #eaffea;
}

/* ---------- ACTION BUTTONS ---------- */
.mainBtn {
  background: #58cc02;
  color: white;
  border: none;
  border-radius: 14px;
  padding: 14px 26px;
  font-size: 22px;
  font-weight: 700;
  cursor: pointer;
  margin: 10px;
}
.mainBtn:hover { background:#46a601 }

/* ---------- STATS ---------- */
.statbox {
  background: white;
  padding: 20px;
  width: 80%;
  margin: 20px auto;
  border-radius: 16px;
  box-shadow: 0 3px 8px #0002;
  text-align: left;
  font-size: 18px;
}

/* Animation for correct/incorrect */
.correctFlash {
  animation: correctAnim 0.4s;
}
@keyframes correctAnim {
  from { background:#b7ffb7; }
  to { background:white; }
}
.wrongFlash {
  animation: wrongAnim 0.4s;
}
@keyframes wrongAnim {
  from { background:#ffd2d2; }
  to { background:white; }
}
</style>
</head>

<body>

<header>Turkish Vocab Trainer</header>

<!-- TABS -->
<div class="tabbar">
  <button id="tabChoice" class="active">4æŠ</button>
  <button id="tabInput">å…¥åŠ›</button>
  <button id="tabStats">Stats</button>
  <button id="tabMistake">è‹¦æ‰‹èªå½™</button>
  <button id="tabFilter">å“è©åˆ¥</button>
</div>

<!-- QUIZ AREA -->
<div id="contentArea">

  <!-- 4æŠãƒ¢ãƒ¼ãƒ‰ -->
  <div id="choiceMode" class="box">
    <div id="question"></div>
    <div id="choices"></div>
    <button class="mainBtn" id="nextBtn">æ¬¡ã¸</button>
  </div>

  <!-- å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ -->
  <div id="inputMode" class="box" style="display:none;">
    <div id="question_input"></div>
    <input type="text" id="inputAnswer" class="inputField" placeholder="ãƒˆãƒ«ã‚³èªã§å…¥åŠ›" />
    <div class="tr-keys">
      <button>Ã§</button><button>ÄŸ</button><button>Ä±</button><button>Ä°</button>
      <button>Ã¶</button><button>ÅŸ</button><button>Ã¼</button>
      <button>Ã‡</button><button>Ä</button><button>Ã–</button>
      <button>Å</button><button>Ãœ</button>
      <button>.</button><button>?</button>
    </div>
    <button class="mainBtn" id="inputCheck">ç­”ãˆã‚‹</button>
    <button class="mainBtn" id="inputNext">æ¬¡ã¸</button>
  </div>

  <!-- Stats -->
  <div id="statsMode" style="display:none;">
    <div class="statbox">
      <h2>ğŸ“Š Stats</h2>
      <p id="stat_total"></p>
      <p id="stat_correct"></p>
      <p id="stat_wrong"></p>
      <p id="stat_rate"></p>
      <h3>è‹¦æ‰‹èªå½™ TOP10</h3>
      <ul id="stat_mistake"></ul>
    </div>
  </div>

  <!-- è‹¦æ‰‹èªå½™ãƒ¢ãƒ¼ãƒ‰ -->
  <div id="mistakeMode" class="box" style="display:none;">
    <h3>è‹¦æ‰‹èªå½™ãƒ¢ãƒ¼ãƒ‰</h3>
    <div id="mistakeInfo"></div>
    <div id="mistakeQuestion"></div>
    <div id="mistakeChoices"></div>
    <button class="mainBtn" id="mistakeNext">æ¬¡ã¸</button>
  </div>

  <!-- å“è©åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ -->
  <div id="filterMode" class="box" style="display:none;">
    <h3>å“è©ã§é¸ã¶</h3>
    <select id="posSelect" style="font-size:20px;padding:10px;border-radius:10px;">
      <option value="all">å…¨éƒ¨</option>
      <option value="noun">åè©</option>
      <option value="verb">å‹•è©</option>
      <option value="adj">å½¢å®¹è©</option>
      <option value="adv">å‰¯è©</option>
      <option value="other">ãã®ä»–</option>
    </select>
    <button class="mainBtn" id="filterStart">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>

</div>

<script src="vocab.js"></script>

<script>
// ---------------------
// DATA
// ---------------------
let current = null;
let mode = "choice"; 
let filteredList = [...vocab];
let mistakeList = JSON.parse(localStorage.getItem("mistakeList") || "[]");

// Stats
let total = Number(localStorage.getItem("total") || 0);
let correct = Number(localStorage.getItem("correct") || 0);
let wrong = Number(localStorage.getItem("wrong") || 0);

// ---------------------
// TAB SWITCHING
// ---------------------
function showTab(name){
  mode = name;

  document.getElementById("choiceMode").style.display = (name==="choice")?"block":"none";
  document.getElementById("inputMode").style.display = (name==="input")?"block":"none";
  document.getElementById("statsMode").style.display = (name==="stats")?"block":"none";
  document.getElementById("mistakeMode").style.display = (name==="mistake")?"block":"none";
  document.getElementById("filterMode").style.display = (name==="filter")?"block":"none";

  document.querySelectorAll(".tabbar button").forEach(btn=>btn.classList.remove("active"));
  if(name==="choice") tabChoice.classList.add("active");
  if(name==="input") tabInput.classList.add("active");
  if(name==="stats") tabStats.classList.add("active");
  if(name==="mistake") tabMistake.classList.add("active");
  if(name==="filter") tabFilter.classList.add("active");

  if(name==="stats") drawStats();
  if(name==="mistake") newMistakeQuestion();
}

tabChoice.onclick = ()=>{ showTab("choice"); newQuestion(); };
tabInput.onclick = ()=>{ showTab("input"); newInputQuestion(); };
tabStats.onclick = ()=>{ showTab("stats"); };
tabMistake.onclick = ()=>{ showTab("mistake"); };
tabFilter.onclick = ()=>{ showTab("filter"); };

// ---------------------
// RANDOM QUESTION
// ---------------------
function pickRandom(list){
  return list[Math.floor(Math.random()*list.length)];
}

// ========== 4æŠ ==========
function newQuestion(){
  current = pickRandom(filteredList);
  question.innerText = current.q;

  let arr = [current.a, ...current.c].sort(()=>Math.random()-0.5);
  choices.innerHTML = "";

  arr.forEach(ans=>{
    let btn = document.createElement("button");
    btn.className = "choice";
    btn.innerText = ans;
    btn.onclick = ()=>checkChoice(ans);
    choices.appendChild(btn);
  });
}

function checkChoice(ans){
  total++;

  if(ans === current.a){
    correct++;
    flash("choiceMode","correctFlash");

    // â­ æ­£è§£ã—ãŸã‚‰è‡ªå‹•ã§æ¬¡ã¸é€²ã‚€ï¼ˆ0.5ç§’ï¼‰
    setTimeout(() => {
      newQuestion();
    }, 500);

  } else {
    wrong++;
    flash("choiceMode","wrongFlash");
    addMistake(current.a);
  }

  saveStats();
}

// ========== å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ ==========
function newInputQuestion(){
  current = pickRandom(filteredList);
  document.getElementById("question_input").innerText = current.q;
  inputAnswer.value = "";
  inputAnswer.focus();
}

inputCheck.onclick = ()=>{
  total++;
  let user = inputAnswer.value.trim().toLowerCase();
  let real = current.a.toLowerCase();
  if(user === real){
    correct++;
    flash("inputMode","correctFlash");

    setTimeout(() => {
      newInputQuestion();
    }, 500);

  } else {
    wrong++;
    flash("inputMode","wrongFlash");
    addMistake(current.a);
  }
  saveStats();
};
inputNext.onclick = newInputQuestion;

// æ–‡å­—ãƒœã‚¿ãƒ³
document.querySelectorAll(".tr-keys button").forEach(btn=>{
  btn.onclick = ()=>{
    inputAnswer.value += btn.textContent;
    inputAnswer.focus();
  }
});

// ---------------------
// è‹¦æ‰‹èªå½™
// ---------------------
function addMistake(word){
  if(!mistakeList.includes(word)){
    mistakeList.push(word);
    localStorage.setItem("mistakeList", JSON.stringify(mistakeList));
  }
}

function newMistakeQuestion(){
  if(mistakeList.length === 0){
    mistakeInfo.innerHTML = "<p>è‹¦æ‰‹èªå½™ã¯ã‚ã‚Šã¾ã›ã‚“ï¼</p>";
    mistakeQuestion.innerHTML = "";
    mistakeChoices.innerHTML = "";
    return;
  }

  let word = pickRandom(mistakeList);
  current = vocab.find(v=>v.a === word);

  mistakeInfo.innerHTML = `<p>è‹¦æ‰‹èªå½™ï¼š${mistakeList.length}èª</p>`;
  mistakeQuestion.innerText = current.q;

  let arr = [current.a, ...current.c].sort(()=>Math.random()-0.5);
  mistakeChoices.innerHTML = "";
  arr.forEach(ans=>{
    let btn = document.createElement("button");
    btn.className = "choice";
    btn.innerText = ans;
    btn.onclick = ()=>checkMistake(ans, word);
    mistakeChoices.appendChild(btn);
  });
}

function checkMistake(ans, word){
  total++;
  if(ans === word){
    correct++;
    mistakeList = mistakeList.filter(x=>x !== word);
    localStorage.setItem("mistakeList", JSON.stringify(mistakeList));
    flash("mistakeMode","correctFlash");
  } else {
    wrong++;
    flash("mistakeMode","wrongFlash");
  }
  saveStats();
}

mistakeNext.onclick = newMistakeQuestion;

// ---------------------
// å“è©åˆ¥
// ---------------------
filterStart.onclick = ()=>{
  let p = posSelect.value;
  if(p==="all") filteredList = [...vocab];
  else filteredList = vocab.filter(v=>v.pos===p);

  alert("ãƒ•ã‚£ãƒ«ã‚¿å®Œäº†ï¼å•é¡Œã‚’é–‹å§‹ã—ã¾ã™ã€‚");
  showTab("choice");
  newQuestion();
};

// ---------------------
// Stats
// ---------------------
function saveStats(){
  localStorage.setItem("total", total);
  localStorage.setItem("correct", correct);
  localStorage.setItem("wrong", wrong);
}

function drawStats(){
  stat_total.innerText = "ç·å›ç­”æ•°ï¼š" + total;
  stat_correct.innerText = "æ­£è§£ï¼š" + correct;
  stat_wrong.innerText = "ä¸æ­£è§£ï¼š" + wrong;
  let rate = (correct/(total||1)*100).toFixed(1);
  stat_rate.innerText = "æ­£ç­”ç‡ï¼š" + rate + "%";

  stat_mistake.innerHTML = "";
  mistakeList.slice(0,10).forEach(w=>{
    let li = document.createElement("li");
    li.innerText = w;
    stat_mistake.appendChild(li);
  });
}

// ---------------------
// Utility
// ---------------------
function flash(id, cls){
  let box = document.getElementById(id);
  box.classList.add(cls);
  setTimeout(()=>box.classList.remove(cls),400);
}

// Start
newQuestion();
</script>

</body>
</html>
